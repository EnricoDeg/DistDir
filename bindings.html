<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DistDir: Bindings</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DistDir
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Bindings </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#python">Python</a></li>
<li class="level1"><a href="#cpp">C++</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="python"></a>
Python</h1>
<p>The generation of python bindings has the objective to simplify the usage of the library, allowing users without low level programming experience to exploit the library in their applications. Python is a natural choice because of its wide usage and its simplicity. Using DistDir library in a python script allows to fully hide the complexity of the language and the algorithm to the end users.</p>
<p>A python module <code>pydistdir</code> can be generated by adding <code>-DENABLE_PYTHON=ON</code> option to the configuration command described in the <a class="el" href="installation.html">Installation</a> page. Once the python module is installed, the folder needs to be added to the <code>PYTHONPATH</code> environment variable. The generation of the python module requires <code>cython</code> and <code>mpi4py</code> which can be easily installed using <code>pip</code>.</p>
<p>This section describe the usage of the library in a python script. The basic principles of the library are still the same, but the interface is slightly different.</p>
<p>First of all, the module must be loaded</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> pydistdir</div>
</div><!-- fragment --><p>Then the library needs to be initialized by calling the constructor of the <code>distdir</code> class</p>
<div class="fragment"><div class="line">dd = pydistdir.distdir()</div>
</div><!-- fragment --><p>The finalization step is handled by python after that all the destructors of the generated objects are called by the garbage collector, so the user does not need to worry to destroy objects or finalize the library.</p>
<p>A <code><a class="el" href="structt__idxlist.html" title="The structure contains information about an index list.">t_idxlist</a></code> object can be created easily passying a <code>numpy</code> array or a tuple:</p>
<div class="fragment"><div class="line">src_idxlist = pydistdir.idxlist([0, 1, 4, 5, 8, 9, 12, 13])</div>
</div><!-- fragment --><p>An empty <code><a class="el" href="structt__idxlist.html" title="The structure contains information about an index list.">t_idxlist</a></code> object can be created not passing any array to the constructor</p>
<div class="fragment"><div class="line">dst_idxlist = pydistdir.idxlist()</div>
</div><!-- fragment --><p>A <code><a class="el" href="structt__map.html">t_map</a></code> object can be created by passing the source and destination <code><a class="el" href="structt__idxlist.html" title="The structure contains information about an index list.">t_idxlist</a></code> objects and the MPI communicator</p>
<div class="fragment"><div class="line">map = pydistdir.map(src_idxlist=src_idxlist, dst_idxlist=dst_idxlist, comm=MPI.COMM_WORLD)</div>
</div><!-- fragment --><p>In addition the <code>stride</code> argument can be passed</p>
<div class="fragment"><div class="line">map = pydistdir.map(src_idxlist=src_idxlist, dst_idxlist=dst_idxlist, comm=MPI.COMM_WORLD, stride=8)</div>
</div><!-- fragment --><p>In case the <code><a class="el" href="structt__map.html">t_map</a></code> object is generated expanding a 2D object, the constructor can be used as follows</p>
<div class="fragment"><div class="line">map = pydistdir.map(map2d=map2d, nlevels=10)</div>
</div><!-- fragment --><p>where the <code>map2d</code> objects was generated by a previous call to <code>pydistdir.map</code>.</p>
<p>A <code><a class="el" href="structt__exchanger.html">t_exchanger</a></code> object can be generated passing the <code><a class="el" href="structt__map.html">t_map</a></code> object, the hardware type and the MPI datatype</p>
<div class="fragment"><div class="line">exchanger = pydistdir.exchanger(map, hw, type)</div>
</div><!-- fragment --><p>where the <code>hw</code> argument is an <code>enum</code> which can be initialized with the following values:</p>
<div class="fragment"><div class="line">hw = pydistdir.pydistdir_hardware.CPU</div>
<div class="line">hw = pydistdir.pydistdir_hardware.GPU_NVIDIA</div>
<div class="line">hw = pydistdir.pydistdir_hardware.GPU_AMD</div>
</div><!-- fragment --><p>and type is an MPI datatype. The following are supported: <code>MPI.DOUBLE</code>, <code>MPI.FLOAT</code> and <code>MPI.INT</code>.</p>
<p>The default hardware is the CPU and the default type is <code>MPI.DOUBLE</code>, so the exchanger can also be created as follows:</p>
<div class="fragment"><div class="line">exchanger = pydistdir.exchanger(map)</div>
</div><!-- fragment --><p>The data to be exchanger can be allocated as a numpy array</p>
<div class="fragment"><div class="line">data = np.array([0, 1, 2, 3, 4, 5, 6, 7], dtype = np.double)</div>
</div><!-- fragment --><p>Finally the <code>go</code> method of the <code><a class="el" href="structt__exchanger.html">t_exchanger</a></code> class can be called</p>
<div class="fragment"><div class="line">exchanger.go(data, data)</div>
</div><!-- fragment --><p>If a transformation is provided on the data layout</p>
<div class="fragment"><div class="line">exchanger.go(data, data, transform_src, transform_dst)</div>
</div><!-- fragment --><p>where <code>transform_src</code> and <code>transform_dst</code> are integer <code>numpy</code> arrays.</p>
<p>If compared with the C API described in the <a class="el" href="start.html">Getting started</a> page, the python interface is significantly easier even if with minor limitations which will be tackled in future developments.</p>
<p>All the C examples provided in the <code>examples</code> folder are replicated in python in the <code>bindings/python/examples</code> folder.</p>
<h1><a class="anchor" id="cpp"></a>
C++</h1>
<p>A tiny wrapper around the library is generated to provide C++ bindings. This is not strictly necessary because a C library can be called directly from C++, but since C++ is based on object oriented programming, a class-based interface is provided for the C library. The header file <code>distdir.hpp</code> should be included. This is installed in the <code>include</code> folder by adding <code>-DENABLE_CXX=ON</code>. The classed belonging to the C++ interface are all defined in <code>distdir</code> namespace.</p>
<p>The library is initialized by calling the constructor of the <code>distdir</code> class:</p>
<div class="fragment"><div class="line">distdir::distdir::Ptr distdir( <span class="keyword">new</span> distdir::distdir() );</div>
</div><!-- fragment --><p>And it is finalized by calling the destructor:</p>
<div class="fragment"><div class="line">distdir.reset();</div>
</div><!-- fragment --><p>A <code>idxlist</code> object can be created passying a <code>vector</code> to the constructor:</p>
<div class="fragment"><div class="line">distdir::idxlist::Ptr idxlist( <span class="keyword">new</span> distdir::idxlist(list) );</div>
</div><!-- fragment --><p>where <code>list</code> is a <code>std::vector&lt;int&gt;</code>.</p>
<p>An empty <code>idxlist</code> object can be created not passing any array to the constructor</p>
<div class="fragment"><div class="line">distdir::idxlist::Ptr idxlist_empty( <span class="keyword">new</span> distdir::idxlist() );</div>
</div><!-- fragment --><p>A <code>map</code> object can be created by passing the source and destination <code>idxlist</code> objects shared pointers and the MPI communicator</p>
<div class="fragment"><div class="line">distdir::map::Ptr map( <span class="keyword">new</span> distdir::map(idxlist, idxlist_empty, MPI_COMM_WORLD) );</div>
</div><!-- fragment --><p>In addition the <code>stride</code> argument can be passed</p>
<div class="fragment"><div class="line">distdir::map::Ptr map( <span class="keyword">new</span> distdir::map(idxlist, idxlist_empty, stride, MPI_COMM_WORLD) );</div>
</div><!-- fragment --><p>In case the <code><a class="el" href="structt__map.html">t_map</a></code> object is generated expanding a 2D object, the constructor can be used as follows</p>
<div class="fragment"><div class="line">distdir::map::Ptr map( <span class="keyword">new</span> distdir::map(map2d, nlevels) );</div>
</div><!-- fragment --><p>where the <code>map2d</code> is a shared pointer to a map object.</p>
<p>A <code>exchanger</code> object can be generated passing the <code>map</code> object shared pointer, the hardware type and the MPI datatype</p>
<div class="fragment"><div class="line">distdir::exchanger&lt;int&gt;::Ptr exchanger ( <span class="keyword">new</span> distdir::exchanger&lt;int&gt;(map, MPI_INT, <a class="code" href="setting_8h.html#a88848da5c7ea10c738db173d5314c659a0035eb0600d18dfc302f6bf7a7cbfa3b">CPU</a>) );</div>
<div class="ttc" id="asetting_8h_html_a88848da5c7ea10c738db173d5314c659a0035eb0600d18dfc302f6bf7a7cbfa3b"><div class="ttname"><a href="setting_8h.html#a88848da5c7ea10c738db173d5314c659a0035eb0600d18dfc302f6bf7a7cbfa3b">CPU</a></div><div class="ttdeci">@ CPU</div><div class="ttdef"><b>Definition:</b> setting.h:38</div></div>
</div><!-- fragment --><p>The <code>exchanger</code> class is templated, in the example it is specified which is used for <code>int</code> types and the type has to match the MPI datatype passed to the constructor. The hardware type is specified using the <code>distdir_hardware</code> enumerator defined in the C library. If not specified, the default hardware type is the CPU:</p>
<div class="fragment"><div class="line">distdir::exchanger&lt;int&gt;::Ptr exchanger ( <span class="keyword">new</span> distdir::exchanger&lt;int&gt;(map, MPI_INT) );</div>
</div><!-- fragment --><p>The data to be exchanger has to be defined in a <code>vector</code>. Finally, the <code>go</code> method of the <code>exchanger</code> class can be called</p>
<div class="fragment"><div class="line">exchanger-&gt;go(data, data);</div>
</div><!-- fragment --><p>If a transformation is provided on the data layout</p>
<div class="fragment"><div class="line">exchanger-&gt;go(data, data, transform_src, transform_dst);</div>
</div><!-- fragment --><p>where <code>transform_src</code> and <code>transform_dst</code> are vector of type <code>int</code>.</p>
<p>If compared with the C API described in the <a class="el" href="start.html">Getting started</a> page, the C++ interface has an object oriented design.</p>
<p>All the C examples provided in the <code>examples</code> folder are replicated in python in the <code>bindings/C++/examples</code> folder. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
